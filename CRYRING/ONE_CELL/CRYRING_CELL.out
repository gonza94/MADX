
  ++++++++++++++++++++++++++++++++++++++++++++
  +     MAD-X 5.05.02  (64 bit, Darwin)      +
  + Support: mad@cern.ch, http://cern.ch/mad +
  + Release   date: 2019.07.25               +
  + Execution date: 2021.03.22 17:38:00      +
  ++++++++++++++++++++++++++++++++++++++++++++
TITLE,'test_TSR.MADX';        



// Definition of the beam

BEAM, PARTICLE=ELECTRON, ENERGY=2500;



// Read the lattice file from the sequence file

CALL, FILE="../CRYRING_CELL.seq";

/***Definition of the elements***/

DM: RBEND, L=1.2*PI/6, ANGLE=PI/6;



kqf=1.4;

kqd=-1.5;



QF: QUADRUPOLE, L=0.3, K1:=kqf;

QD: QUADRUPOLE, L=0.3, K1:=kqd;



ksf=0;

ksd=0;

//SF: SEXTUPOLE, L=0.2, K2:=ksf;

//SD: SEXTUPOLE, L=0.2, K2:=ksd; 



LTOTAL=1.75+(1.2*PI/6)+0.35+0.2+0.05+0.3+0.624+0.2+0.05+0.3+0.05+0.2+0.624+0.3+0.05+0.2+0.35+(1.2*PI/6)+1.75;



/***Definition of sequence***/

CRYF: SEQUENCE, REFER=ENTRY, L=LTOTAL;

 

 DM1: DM, AT=1.75;

 QF1: QF, AT=1.75+(1.2*PI/6)+0.35+0.2+0.05;

 QD1: QD, AT=1.75+(1.2*PI/6)+0.35+0.2+0.05+0.3+0.624+0.2+0.05;

 //SD1: SD, AT=1.75+(1.2*PI/6)+0.35+0.2+0.05+0.3+0.624+0.2+0.05+0.3+0.05;

 QF2: QF, AT=1.75+(1.2*PI/6)+0.35+0.2+0.05+0.3+0.624+0.2+0.05+0.3+0.05+0.2+0.624;

 //SF1: SF, AT=1.75+(1.2*PI/6)+0.35+0.2+0.05+0.3+0.624+0.2+0.05+0.3+0.05+0.2+0.624+0.3+0.05;

 DM2: DM, AT=1.75+(1.2*PI/6)+0.35+0.2+0.05+0.3+0.624+0.2+0.05+0.3+0.05+0.2+0.624+0.3+0.05+0.2+0.35;





ENDSEQUENCE;
OPTION, ECHO;



// Activation of the sequence 

USE, SEQUENCE=CRYF;



/*** Plot matched Twiss parameters ***/

MATCH, SEQUENCE=CRYF;

START MATCHING

number of sequences: 1
sequence name: cryf
GLOBAL, SEQUENCE=CRYF, Q1=2.42/6, Q2=2.42/6;

VARY,NAME=kqf,STEP=0.001,LOWER=1,UPPER=2.;

VARY,NAME=kqd,STEP=0.001,UPPER=-1.5,LOWER=-2.5;

MIGRAD,CALLS=10000,TOLERANCE=1E-20;

number of variables:    2
user given constraints: 2
total constraints:      2

START MIGRAD:

 reset parameter:kqd                                             from  -1.5000000000000000      to  -1.5000000000000000     
call:      13   Penalty function =   0.11083405E+00
call:      22   Penalty function =   0.88631494E-01
call:      30   Penalty function =   0.19602088E-01
call:      37   Penalty function =   0.36590745E-03
call:      43   Penalty function =   0.16553850E-05
call:      50   Penalty function =   0.45179379E-11
call:      56   Penalty function =   0.87961577E-14
call:      62   Penalty function =   0.17789717E-22
 verify
 converged
call:      73   Penalty function =   0.29890433E-28
ENDMATCH;


MATCH SUMMARY

Node_Name                  Constraint   Type  Target Value       Final Value        Penalty
--------------------------------------------------------------------------------------------------
Global constraint:         q1           4     4.03333333E-01     4.03333333E-01     2.49600521E-29
Global constraint:         q2           4     4.03333333E-01     4.03333333E-01     4.93038066E-30


Final Penalty Function =   2.98904327e-29





Variable                 Final Value  Initial Value Lower Limit  Upper Limit 
--------------------------------------------------------------------------------
kqf                       1.70314e+00  1.40000e+00  1.00000e+00  2.00000e+00
kqd                      -1.99668e+00 -1.50000e+00 -2.50000e+00 -1.50000e+00

END MATCH SUMMARY

VARIABLE "TAR" SET TO   2.98904327e-29


// Calculate and save periodic Twiss solution

TWISS,SAVE,FILE=CRYRING;

enter Twiss module
  
iteration:   1 error:   0.000000E+00 deltap:   0.000000E+00
orbit:   0.000000E+00  0.000000E+00  0.000000E+00  0.000000E+00  0.000000E+00  0.000000E+00

++++++ table: summ

            length             orbit5               alfa            gammatr 
       8.604637061                 -0       0.1823398809        2.341850498 

                q1                dq1            betxmax              dxmax 
      0.4033333333      -0.2395138137        6.541876473        1.906923798 

             dxrms             xcomax             xcorms                 q2 
        1.61526969                  0                  0       0.4033333333 

               dq2            betymax              dymax              dyrms 
     -0.5161081036        5.016658613                  0                  0 

            ycomax             ycorms             deltap            synch_1 
                 0                  0                  0                  0 

           synch_2            synch_3            synch_4            synch_5 
                 0                  0                  0                  0 

            nflips 
                 0 


// Plot betax and betay vs s (with interpolation)

PLOT,HAXIS=S,VAXIS1=BETX,BETY,DX,colour=100,FILE=CRYRING_PLOT,interpolate;

Plot - default table plotted: twiss

 GXPLOT-X11  1.50 initialized

 plot number =            1
PLOT,HAXIS=S,VAXIS1=DX,colour=100,FILE=tsr_plot,interpolate;

Plot - default table plotted: twiss
 plot number =            2


STOP;

  Number of warnings: 0

  ++++++++++++++++++++++++++++++++++++++++++++
  +          MAD-X finished normally         +
  ++++++++++++++++++++++++++++++++++++++++++++
